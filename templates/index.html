<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fitness Hub Pro</title>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>

    <script src="/static/js/i18n.js?v=7"></script>

    <link rel="stylesheet" href="/static/css/style.css?v=44">
</head>
<body>

    <div id="loading-view" class="view active loader-container">
        <div class="spinner"></div>
        <h3 id="loading-text" data-i18n="loading_ai">–ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –•–∞–±—É...</h3>
    </div>

    <div id="form-view" class="view">
        <h2 style="margin-top: 20px;" data-i18n="title_create_profile">–°—Ç–≤–æ—Ä–∏—Ç–∏ –ü—Ä–æ—Ñ—ñ–ª—å</h2>
        <p style="color: var(--hint-color); font-size: 14px; margin-bottom: 20px;" data-i18n="desc_create_profile">–°–∏—Å—Ç–µ–º–∞ —ñ–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–æ —Ä–æ–∑—Ä–∞—Ö—É—î –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏–π –º–∞–∫—Ä–æ- —Ç–∞ –º—ñ–∫—Ä–æ—Ü–∏–∫–ª –Ω–∞ –æ—Å–Ω–æ–≤—ñ –≤–∞—à–∏—Ö –¥–∞–Ω–∏—Ö.</p>

        <label data-i18n="label_name">–Ü–º'—è</label>
        <input type="text" id="user_name" placeholder="–Ø–∫ –¥–æ –≤–∞—Å –∑–≤–µ—Ä—Ç–∞—Ç–∏—Å—è?" data-i18n-placeholder="placeholder_name">

        <div style="display: flex; gap: 15px;">
            <div style="flex: 1;">
                <label data-i18n="label_gender">–°—Ç–∞—Ç—å</label>
                <select id="gender" onchange="if(typeof toggleCycleContainer === 'function') toggleCycleContainer('gender', 'cycle_container')">
                    <option value="male" data-i18n="gender_male">–ß–æ–ª–æ–≤—ñ—á–∞</option>
                    <option value="female" data-i18n="gender_female">–ñ—ñ–Ω–æ—á–∞</option>
                </select>
            </div>
            <div style="flex: 1;">
                <label data-i18n="label_age">–í—ñ–∫</label>
                <input type="number" id="age" placeholder="–†–æ–∫—ñ–≤" data-i18n-placeholder="placeholder_age">
            </div>
        </div>

        <div id="cycle_container" style="display: none; background: rgba(255, 45, 85, 0.05); padding: 15px; border-radius: 12px; border: 1px dashed rgba(255, 45, 85, 0.3); margin-bottom: 15px; margin-top: 10px;">
            <label style="color: #ff2d55; margin-top: 0;" data-i18n="cycle_start_label">–ü–µ—Ä—à–∏–π –¥–µ–Ω—å –æ—Å—Ç. –º–µ–Ω—Å—Ç—Ä—É–∞—Ü—ñ—ó</label>
            <input type="date" id="cycle_start_date">
            <label style="color: #ff2d55;" data-i18n="cycle_length_label">–°–µ—Ä–µ–¥–Ω—è —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å —Ü–∏–∫–ª—É (–¥–Ω—ñ–≤)</label>
            <input type="number" id="cycle_length" value="28">
        </div>

        <div style="display: flex; gap: 15px;">
            <div style="flex: 1;">
                <label data-i18n="label_height">–ó—Ä—ñ—Å—Ç (—Å–º)</label>
                <input type="number" id="height" placeholder="–ù–∞–ø—Ä: 175">
            </div>
            <div style="flex: 1;">
                <label data-i18n="label_weight">–í–∞–≥–∞ (–∫–≥)</label>
                <input type="number" id="weight" placeholder="–ù–∞–ø—Ä: 70" step="0.1">
            </div>
        </div>

        <label data-i18n="label_goal">–í–∞—à–∞ –≥–æ–ª–æ–≤–Ω–∞ —Ü—ñ–ª—å</label>
        <select id="goal" onchange="if(typeof toggleCustomGoal === 'function') toggleCustomGoal('goal', 'custom-goal-container', 'custom_goal')">
            <option value="lose" data-i18n="goal_lose">–°—Ö—É–¥–Ω–µ–Ω–Ω—è / –°—É—à–∫–∞ üî•</option>
            <option value="maintain" selected data-i18n="goal_maintain">–ü—ñ–¥—Ç—Ä–∏–º–∫–∞ —Ñ–æ—Ä–º–∏ ‚öñÔ∏è</option>
            <option value="gain" data-i18n="goal_gain">–ù–∞–±—ñ—Ä –º'—è–∑–æ–≤–æ—ó –º–∞—Å–∏ üí™</option>
            <option value="strength" data-i18n="goal_strength">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ —Å–∏–ª–∞ üèãÔ∏è</option>
            <option value="endurance" data-i18n="goal_endurance">–í–∏—Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å üèÉ</option>
            <option value="competition" data-i18n="goal_competition">üèÜ –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–æ –∑–º–∞–≥–∞–Ω—å</option>
            <option value="custom" data-i18n="goal_custom">–°–≤–æ—è —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω–∞ —Ü—ñ–ª—å üéØ</option>
        </select>

        <div id="custom-goal-container" style="display: none;">
            <label data-i18n="label_custom_goal">–û–ø–∏—à—ñ—Ç—å –≤–∞—à—É —Ü—ñ–ª—å –¥–µ—Ç–∞–ª—å–Ω–æ</label>
            <input type="text" id="custom_goal" placeholder="–ù–∞–ø—Ä: –•–æ—á—É –Ω–∞–≤—á–∏—Ç–∏—Å—è –ø—ñ–¥—Ç—è–≥—É–≤–∞—Ç–∏—Å—è 20 —Ä–∞–∑—ñ–≤">
        </div>

        <div id="competition-container" style="display: none; background: rgba(255, 214, 10, 0.05); padding: 15px; border-radius: 12px; border: 1px dashed rgba(255, 214, 10, 0.3); margin-bottom: 15px;">
            <label style="color: var(--accent-gold); margin-top: 0;" data-i18n="comp_sport_label">–í–∞—à –≤–∏–¥ —Å–ø–æ—Ä—Ç—É</label>
            <input type="text" id="comp_sport" placeholder="–ù–∞–ø—Ä: –ü–∞—É–µ—Ä–ª—ñ—Ñ—Ç–∏–Ω–≥, –ö—Ä–æ—Å—Ñ—ñ—Ç">
            <label style="color: var(--accent-gold);" data-i18n="comp_date_label">–î–∞—Ç–∞ –∑–º–∞–≥–∞–Ω—å (–ü—ñ–∫ —Ñ–æ—Ä–º–∏)</label>
            <input type="date" id="comp_date">
        </div>

        <label data-i18n="label_target_weight">–¶—ñ–ª—å–æ–≤–∞ –≤–∞–≥–∞ (–∫–≥)</label>
        <input type="number" id="target_weight" placeholder="–°–∫—ñ–ª—å–∫–∏ —Ö–æ—á–µ—Ç–µ –≤–∞–∂–∏—Ç–∏?" step="0.1">

        <label data-i18n="label_activity">–†—ñ–≤–µ–Ω—å —Ñ—ñ–∑–∏—á–Ω–æ—ó –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ</label>
        <select id="activity">
            <option value="sedentary" data-i18n="act_sedentary">–°–∏–¥—è—á–∏–π (–æ—Ñ—ñ—Å)</option>
            <option value="light" data-i18n="act_light">–õ–µ–≥–∫–∏–π (1-3 —Ä–∞–∑–∏/—Ç–∏–∂)</option>
            <option value="medium" selected data-i18n="act_medium">–°–µ—Ä–µ–¥–Ω—ñ–π (3-5 —Ä–∞–∑—ñ–≤/—Ç–∏–∂)</option>
            <option value="active" data-i18n="act_active">–í–∏—Å–æ–∫–∏–π (6-7 —Ä–∞–∑—ñ–≤/—Ç–∏–∂)</option>
            <option value="very_active" data-i18n="act_very_active">–î—É–∂–µ –≤–∏—Å–æ–∫–∏–π (—Ñ—ñ–∑–∏—á–Ω–∞ —Ä–æ–±–æ—Ç–∞)</option>
        </select>

        <label data-i18n="label_notes">–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ (—Ç—Ä–∞–≤–º–∏, –ø–æ–±–∞–∂–∞–Ω–Ω—è)</label>
        <textarea id="notes" rows="3" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –±–æ–ª–∏—Ç—å –ø—Ä–∞–≤–µ –∫–æ–ª—ñ–Ω–æ..."></textarea>

        <button id="submit-btn" onclick="submitProfile()" style="margin-bottom: 30px;" data-i18n="btn_generate">üöÄ –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –ü—Ä–æ–≥—Ä–∞–º—É</button>
    </div>

    <div id="profile-view" class="view">

        <div style="margin-top: 20px; display: flex; flex-direction: column; gap: 10px;">
            <button id="btn-admin-panel" onclick="window.location.href='/admin'" style="display: none; margin:0; background: rgba(191, 90, 242, 0.15); color: #bf5af2; box-shadow: none;" data-i18n="btn_admin">
                ‚öôÔ∏è –°—É–ø–µ—Ä –ê–¥–º—ñ–Ω –ü–∞–Ω–µ–ª—å
            </button>

            <div id="trainer-switch-container" style="display: none;">
                <button onclick="window.location.href='/trainer'" style="margin:0; background: rgba(50, 215, 75, 0.15); color: var(--success); box-shadow: none; width: 100%;" data-i18n="btn_trainer_panel">
                    üë®‚Äçüè´ –í—ñ–¥–∫—Ä–∏—Ç–∏ –ø–∞–Ω–µ–ª—å –¢—Ä–µ–Ω–µ—Ä–∞
                </button>
            </div>

            <button id="btn-become-trainer" onclick="if(typeof registerAsTrainer === 'function') registerAsTrainer()" style="display: none; margin:0; background: rgba(255, 214, 10, 0.15); color: var(--accent-gold); box-shadow: none;" data-i18n="btn_trainer">
                üéì –°—Ç–∞—Ç–∏ –¢—Ä–µ–Ω–µ—Ä–æ–º
            </button>
        </div>

        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 20px;">
            <h2 style="margin: 0;"><span data-i18n="greeting">–ü—Ä–∏–≤—ñ—Ç</span>, <span id="prof-name">–ê—Ç–ª–µ—Ç</span>! <span id="prof-mini-lvl" style="color:var(--accent-gold); font-size:18px;"></span></h2>
            <button onclick="openEditProfileModal()" style="width: auto; padding: 8px 15px; margin: 0; font-size: 14px; background: rgba(255,255,255,0.1); box-shadow: none;" data-i18n="btn_edit_data">‚úèÔ∏è –î–∞–Ω—ñ</button>
        </div>

        <div id="prof-trainer-status" style="display: none; background: rgba(10, 132, 255, 0.1); color: var(--client-blue); padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: bold; margin-top: 8px; border: 1px solid rgba(10, 132, 255, 0.2);">
            –í –∫–æ–º–∞–Ω–¥—ñ —Ç—Ä–µ–Ω–µ—Ä–∞
        </div>

        <div class="card comp-card" style="margin-top: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h3 style="margin-top:0; color: var(--accent-gold);" data-i18n="title_my_comp">üèÜ –ú–æ—ó –∑–º–∞–≥–∞–Ω–Ω—è</h3>
                <button onclick="openQuickCompModal()" style="width: auto; padding: 5px 12px; margin: 0; font-size: 12px; background: rgba(255, 214, 10, 0.2); color: var(--accent-gold); box-shadow: none;" data-i18n="btn_settings">–ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏</button>
            </div>

            <div id="comp-active-view" style="display: none; margin-top: 10px;">
                <div style="font-size: 20px; font-weight: 900;" id="comp-sport-display">–°–ø–æ—Ä—Ç</div>
                <div style="font-size: 14px; color: var(--text-color); margin-top: 5px; opacity: 0.9;"><span data-i18n="comp_date_short">–î–∞—Ç–∞:</span> <b id="comp-date-display">...</b></div>
                <div style="margin-top: 15px; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 8px; text-align: center;">
                    <div style="font-size: 18px; font-weight: bold; color: var(--success);" id="comp-countdown-display">‚è≥ ...</div>
                </div>
            </div>

            <div id="comp-empty-view" style="margin-top: 10px;">
                <p style="font-size: 13px; color: var(--hint-color); margin: 0;" data-i18n="comp_empty_desc">–í–∏ –Ω–µ –≥–æ—Ç—É—î—Ç–µ—Å—å –¥–æ –∑–º–∞–≥–∞–Ω—å. –ë–∞–∂–∞—î—Ç–µ –ø–æ–±—É–¥—É–≤–∞—Ç–∏ –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–π –º–∞–∫—Ä–æ—Ü–∏–∫–ª –¥–ª—è –≤–∏—Ö–æ–¥—É –Ω–∞ –ø—ñ–∫ —Ñ–æ—Ä–º–∏?</p>
            </div>
        </div>

        <h3 style="margin-top: 30px; margin-bottom: 10px;" data-i18n="title_phys_data">–§—ñ–∑–∏—á–Ω—ñ –¥–∞–Ω—ñ</h3>
        <div class="profile-grid">
            <div class="profile-stat"><div class="stat-value" id="prof-weight">0 –∫–≥</div><div class="stat-label" data-i18n="stat_cur_weight">–ü–æ—Ç–æ—á–Ω–∞ –≤–∞–≥–∞</div></div>
            <div class="profile-stat"><div class="stat-value" id="prof-target" style="color: var(--accent-gold);">0 –∫–≥</div><div class="stat-label" data-i18n="stat_target_weight">–¶—ñ–ª—å–æ–≤–∞ –≤–∞–≥–∞</div></div>
            <div class="profile-stat"><div class="stat-value" id="prof-height">0 —Å–º</div><div class="stat-label" data-i18n="stat_height">–ó—Ä—ñ—Å—Ç</div></div>
            <div class="profile-stat"><div class="stat-value" id="prof-age">0</div><div class="stat-label" data-i18n="stat_age">–í—ñ–∫</div></div>
        </div>

        <div class="card" style="margin-top: 20px;">
            <div style="margin-bottom: 10px;"><span class="stat-label" data-i18n="stat_cur_goal">–ü–æ—Ç–æ—á–Ω–∞ —Ü—ñ–ª—å:</span> <b id="prof-goal" style="float: right;">...</b></div>
            <div><span class="stat-label" data-i18n="stat_activity">–†—ñ–≤–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ:</span> <b id="prof-activity" style="float: right;">...</b></div>
        </div>

        <div class="card" style="margin-top: 20px; border: 1px dashed var(--btn-color); background: rgba(10, 132, 255, 0.05);">
            <h3 style="margin-top:0; color: var(--btn-color);">‚ú® <span data-i18n="title_ai_adapt">–®–Ü-–ê–¥–∞–ø—Ç–∞—Ü—ñ—è –ø–ª–∞–Ω—É</span></h3>
            <p style="font-size: 12px; color: var(--text-color); opacity: 0.8; margin-top: 0;" data-i18n="desc_ai_adapt">–û—Ç—Ä–∏–º–∞–ª–∏ —Ç—Ä–∞–≤–º—É? –ó–º—ñ–Ω–∏–≤—Å—è –≥—Ä–∞—Ñ—ñ–∫? –ù–∞–ø–∏—à—ñ—Ç—å —Å—é–¥–∏, —ñ –®–Ü –º–∏—Ç—Ç—î–≤–æ –∞–¥–∞–ø—Ç—É—î –≤–∞—à –ø–ª–∞–Ω –ø—ñ–¥ –Ω–æ–≤—ñ —Ä–µ–∞–ª—ñ—ó.</p>
            <textarea id="smart-rebuild-text" rows="3" placeholder="–ù–∞–ø—Ä: –Ø —Ä–æ–∑—Ç—è–≥–Ω—É–≤ —Å–ø–∏–Ω—É..."></textarea>
            <button id="btn-smart-rebuild" onclick="smartRebuildPlan()" style="margin-top:10px; background: rgba(10, 132, 255, 0.15); color: var(--client-blue); box-shadow: none;" data-i18n="btn_rebuild_plan">üîÑ –ü–µ—Ä–µ–±—É–¥—É–≤–∞—Ç–∏ –º—ñ–π –ø–ª–∞–Ω</button>
        </div>

        <div class="card" style="margin-top: 20px; margin-bottom: 40px;">
            <h3 style="margin-top:0;" data-i18n="client_food_prefs">‚ö†Ô∏è –í–ø–æ–¥–æ–±–∞–Ω–Ω—è —Ç–∞ –ê–ª–µ—Ä–≥—ñ—ó</h3>
            <p style="font-size: 12px; color: var(--hint-color); margin-top: 0;" data-i18n="desc_allergies">–û–ø–∏—à—ñ—Ç—å, —â–æ –≤–∏ –Ω–µ —ó—Å—Ç–µ –∞–±–æ –Ω–∞ —â–æ –º–∞—î—Ç–µ –∞–ª–µ—Ä–≥—ñ—é, —â–æ–± —Ç—Ä–µ–Ω–µ—Ä –º—ñ–≥ —Å–∫–ª–∞—Å—Ç–∏ —ñ–¥–µ–∞–ª—å–Ω–∏–π —Ä–∞—Ü—ñ–æ–Ω.</p>
            <textarea id="food-prefs-input" rows="3" placeholder="–ù–∞–ø—Ä: –ê–ª–µ—Ä–≥—ñ—è –Ω–∞ –∞—Ä–∞—Ö—ñ—Å..."></textarea>
            <button class="secondary" onclick="saveFoodPrefs()" style="margin-top:10px;" data-i18n="btn_save_for_coach">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –¥–ª—è —Ç—Ä–µ–Ω–µ—Ä–∞</button>
        </div>
    </div>

    <div id="dashboard-view" class="view">
        <h2 id="plan-title" style="margin-top:20px; line-height: 1.2;" data-i18n="title_plan">–í–∞—à –ü–ª–∞–Ω</h2>

        <div id="dashboard-comp-banner" style="display: none; background: rgba(255, 214, 10, 0.1); border: 1px dashed var(--accent-gold); padding: 12px; border-radius: 12px; margin-bottom: 15px;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <div style="font-size: 12px; color: var(--accent-gold); font-weight: bold; text-transform: uppercase;">üèÜ <span data-i18n="dash_comp_prep">–ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–æ:</span></div>
                    <div style="font-size: 16px; font-weight: 900; color: var(--text-color);" id="dash-comp-sport">–°–ø–æ—Ä—Ç</div>
                </div>
                <div style="text-align: right;">
                    <div style="font-size: 18px; font-weight: bold; color: var(--success);" id="dash-comp-days">‚è≥ --</div>
                </div>
            </div>
        </div>

        <div id="ai-insight-box" class="ai-insight" style="display: none;">
            <div style="font-weight: bold; margin-bottom: 5px; color: var(--btn-color);">üß† <span data-i18n="ai_insight_title">–¢—Ä–µ–Ω—É–≤–∞–ª—å–Ω–∏–π —Ü–∏–∫–ª</span></div>
            <div id="plan-explanation" style="font-size: 14px; opacity: 0.9; white-space: pre-wrap;"></div>
        </div>

        <div id="ai-projection-box" class="ai-projection" style="display: none;">
            <div style="font-weight: bold; margin-bottom: 5px; color: var(--accent-gold);">üéØ <span data-i18n="ai_proj_title">–†–æ–∑—Ä–∞—Ö—É–Ω–∫–æ–≤–∏–π –ø—Ä–æ–≥–Ω–æ–∑</span></div>
            <div id="plan-projections" style="font-size: 14px; opacity: 0.9; white-space: pre-wrap;"></div>
        </div>

        <div id="day-tabs-container" class="day-tabs" style="display: none;"></div>

        <div id="checkin-card" class="card" style="border: 1px solid var(--btn-color); display: none;">
            <h3 style="margin-top: 0; color: var(--btn-color);">üìä <span data-i18n="chk_title">–Ø–∫ –≤–∏ —Å–µ–±–µ –ø–æ—á—É–≤–∞—î—Ç–µ?</span></h3>
            <p style="font-size: 13px; color: var(--hint-color); margin-bottom: 15px;"></p>
            <label data-i18n="chk_sleep">–°–æ–Ω (1 - –∂–∞—Ö–ª–∏–≤–æ, 10 - —ñ–¥–µ–∞–ª—å–Ω–æ)</label><input type="range" id="chk-sleep" min="1" max="10" value="5">
            <label data-i18n="chk_energy">–ï–Ω–µ—Ä–≥—ñ—è (1 - —Ä–æ–∑–±–∏—Ç–∏–π, 10 - –ø–æ–≤–µ–Ω —Å–∏–ª)</label><input type="range" id="chk-energy" min="1" max="10" value="5">
            <label data-i18n="chk_stress">–°—Ç—Ä–µ—Å (1 - –¥—É–∂–µ –Ω–∏–∑—å–∫–∏–π, 10 - –ø–∞–Ω—ñ–∫–∞)</label><input type="range" id="chk-stress" min="1" max="10" value="5">
            <label data-i18n="chk_soreness">–ë—ñ–ª—å (1 - –Ω—ñ—á–æ–≥–æ, 10 - –≤—Å–µ –±–æ–ª–∏—Ç—å)</label><input type="range" id="chk-soreness" min="1" max="10" value="5">
            <button onclick="submitCheckin()" id="btn-checkin" data-i18n="btn_adapt_workout">–ê–¥–∞–ø—Ç—É–≤–∞—Ç–∏ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è ‚ö°</button>
        </div>

        <div id="coach-message-box" class="coach-message" style="display: none;">
            <div style="font-weight: bold; margin-bottom: 5px; color: var(--success);">üí¨ <span data-i18n="msg_from_coach">–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¢—Ä–µ–Ω–µ—Ä–∞</span></div>
            <div id="coach-message-text" style="font-size: 14px; opacity: 0.9; white-space: pre-wrap;"></div>
        </div>

        <div id="workout-container" style="padding-bottom: 80px;"></div>
    </div>

    <div id="cycle-view" class="view" style="padding-bottom: 80px;">
        <h2 style="margin-top:20px;" data-i18n="title_cycle">–í–∞—à –¶–∏–∫–ª</h2>
        <div class="card" style="text-align: center;">
            <div id="cycle-ring-circle" class="cycle-ring" style="width: 180px; height: 180px; border-radius: 50%; border: 12px solid rgba(255,255,255,0.05); margin: 0 auto 20px auto; display: flex; align-items: center; justify-content: center; position: relative;">
                <div id="cycle-ring-text" style="text-align: center; line-height: 1.2;">Day 1</div>
            </div>
            <button id="btn-log-period" onclick="logPeriodStart()" style="background: rgba(255, 45, 85, 0.15); color: #ff2d55; box-shadow: none;" data-i18n="btn_log_period">ü©∏ –í—ñ–¥–º—ñ—Ç–∏—Ç–∏ –ø–æ—á–∞—Ç–æ–∫ —Ü–∏–∫–ª—É —Å—å–æ–≥–æ–¥–Ω—ñ</button>
        </div>
        <div class="card" style="margin-top: 15px;">
            <h3 style="margin-top:0;" data-i18n="title_symptoms">–°–∏–º–ø—Ç–æ–º–∏ —Å—å–æ–≥–æ–¥–Ω—ñ</h3>
            <p style="font-size: 13px; color: var(--hint-color); margin-bottom: 8px; font-weight: bold;" data-i18n="symp_flow">–í–∏–¥—ñ–ª–µ–Ω–Ω—è</p>
            <div style="display: flex; gap: 8px; margin-bottom: 15px;">
                <div class="symptom-chip" data-category="flow" data-value="light" onclick="toggleSymptom(this, 'flow', 'light')" style="padding: 8px 16px; background: rgba(255,255,255,0.05); border-radius: 20px; font-size: 13px;" data-i18n="symp_light">–õ–µ–≥–∫—ñ</div>
                <div class="symptom-chip" data-category="flow" data-value="medium" onclick="toggleSymptom(this, 'flow', 'medium')" style="padding: 8px 16px; background: rgba(255,255,255,0.05); border-radius: 20px; font-size: 13px;" data-i18n="symp_medium">–°–µ—Ä–µ–¥–Ω—ñ</div>
                <div class="symptom-chip" data-category="flow" data-value="heavy" onclick="toggleSymptom(this, 'flow', 'heavy')" style="padding: 8px 16px; background: rgba(255,255,255,0.05); border-radius: 20px; font-size: 13px;" data-i18n="symp_heavy">–†—è—Å–Ω—ñ</div>
            </div>
            <p style="font-size: 13px; color: var(--hint-color); margin-bottom: 8px; font-weight: bold;" data-i18n="symp_pain">–ë—ñ–ª—å / –°–ø–∞–∑–º–∏</p>
            <div style="display: flex; gap: 8px; margin-bottom: 15px;">
                <div class="symptom-chip" data-category="pain" data-value="0" onclick="toggleSymptom(this, 'pain', '0')" style="padding: 8px 16px; background: rgba(255,255,255,0.05); border-radius: 20px; font-size: 13px;" data-i18n="symp_none">–ù–µ–º–∞—î</div>
                <div class="symptom-chip" data-category="pain" data-value="1" onclick="toggleSymptom(this, 'pain', '1')" style="padding: 8px 16px; background: rgba(255,255,255,0.05); border-radius: 20px; font-size: 13px;" data-i18n="symp_mild">–õ–µ–≥–∫–∏–π</div>
                <div class="symptom-chip" data-category="pain" data-value="2" onclick="toggleSymptom(this, 'pain', '2')" style="padding: 8px 16px; background: rgba(255,255,255,0.05); border-radius: 20px; font-size: 13px;" data-i18n="symp_severe">–°–∏–ª—å–Ω–∏–π</div>
            </div>
            <p style="font-size: 13px; color: var(--hint-color); margin-bottom: 8px; font-weight: bold;" data-i18n="symp_mood">–ù–∞—Å—Ç—Ä—ñ–π</p>
            <div style="display: flex; gap: 8px;">
                <div class="symptom-chip" data-category="mood" data-value="calm" onclick="toggleSymptom(this, 'mood', 'calm')" style="padding: 8px 16px; background: rgba(255,255,255,0.05); border-radius: 20px; font-size: 13px;" data-i18n="symp_calm">–°–ø–æ–∫—ñ–π–Ω–∏–π</div>
                <div class="symptom-chip" data-category="mood" data-value="sad" onclick="toggleSymptom(this, 'mood', 'sad')" style="padding: 8px 16px; background: rgba(255,255,255,0.05); border-radius: 20px; font-size: 13px;" data-i18n="symp_sad">–°—É–º–Ω–∏–π</div>
                <div class="symptom-chip" data-category="mood" data-value="irritated" onclick="toggleSymptom(this, 'mood', 'irritated')" style="padding: 8px 16px; background: rgba(255,255,255,0.05); border-radius: 20px; font-size: 13px;" data-i18n="symp_irritated">–î—Ä–∞—Ç—ñ–≤–ª–∏–≤–∏–π</div>
            </div>
        </div>
        <div class="card" style="margin-top: 15px; border: 1px dashed #ff2d55; background: rgba(255, 45, 85, 0.05);">
            <h3 style="margin-top:0; color: #ff2d55;">‚ú® <span data-i18n="title_ai_cycle">–®–Ü-–ê–Ω–∞–ª—ñ–∑ —Ü–∏–∫–ª—É</span></h3>
            <p id="cycle-insight-text" style="font-size: 14px; opacity: 0.9; margin-bottom: 0;" data-i18n="loading_ai">–ê–Ω–∞–ª—ñ–∑—É—î–º–æ –≤–ø–ª–∏–≤ –≥–æ—Ä–º–æ–Ω—ñ–≤ –Ω–∞ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è...</p>
        </div>
    </div>

    <div id="nutrition-view" class="view">
        <h2 style="margin-top:20px;" data-i18n="title_nutrition">–©–æ–¥–µ–Ω–Ω–∏–∫ –•–∞—Ä—á—É–≤–∞–Ω–Ω—è</h2>

        <div class="card" id="coach-nutrition-card" style="display:none; border: 1px solid var(--trainer-green); background: rgba(50, 215, 75, 0.05);">
            <h3 style="color: var(--trainer-green); margin-top:0;">üë®‚Äçüè´ <span data-i18n="title_coach_diet">–†–∞—Ü—ñ–æ–Ω –≤—ñ–¥ —Ç—Ä–µ–Ω–µ—Ä–∞</span></h3>
            <p id="coach-nutrition-plan" style="white-space: pre-wrap; font-size: 14px; margin-bottom: 0;"></p>
        </div>

        <div class="card" style="text-align: center; padding: 25px 15px;">
            <div id="cal-status" style="display: inline-block; padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; margin-bottom: 15px; background: rgba(255,255,255,0.1);">...</div>
            <div id="cal-main" style="font-size: 48px; font-weight: 900; letter-spacing: -1px;">0 <span style="font-size: 24px; color: var(--hint-color); font-weight: normal;">/ 0</span></div>
            <div style="font-size: 13px; color: var(--hint-color); margin-top: 5px;" data-i18n="card_macros">–∫–∞–ª–æ—Ä—ñ–π —Å–ø–æ–∂–∏—Ç–æ —Å—å–æ–≥–æ–¥–Ω—ñ</div>
            <div class="nutri-grid">
                <div class="nutri-item"><span style="font-weight: bold; color: var(--text-color);" data-i18n="macro_protein">–ë—ñ–ª–∫–∏</span><span id="p-val" class="nutri-val">0 / 0 –≥</span><div class="progress-circle"><div id="p-bar" class="progress-circle-fill"></div></div></div>
                <div class="nutri-item"><span style="font-weight: bold; color: var(--text-color);" data-i18n="macro_fats">–ñ–∏—Ä–∏</span><span id="f-val" class="nutri-val">0 / 0 –≥</span><div class="progress-circle"><div id="f-bar" class="progress-circle-fill" style="background:var(--accent-gold);"></div></div></div>
                <div class="nutri-item"><span style="font-weight: bold; color: var(--text-color);" data-i18n="macro_carbs">–í—É–≥–ª–µ–≤–æ–¥–∏</span><span id="c-val" class="nutri-val">0 / 0 –≥</span><div class="progress-circle"><div id="c-bar" class="progress-circle-fill" style="background:var(--success);"></div></div></div>
            </div>
        </div>

        <div class="card" style="margin-top: 15px; text-align: center;">
            <h3 style="margin-top: 0; color: #0a84ff; display: flex; align-items: center; justify-content: center; gap: 8px;">üíß <span data-i18n="card_water">–í–æ–¥–Ω–∏–π –±–∞–ª–∞–Ω—Å</span></h3>
            <div style="font-size: 28px; font-weight: 900; margin-bottom: 15px; color: #0a84ff;" id="water-val">0 –º–ª</div>
            <div style="display: flex; justify-content: center; gap: 8px; flex-wrap: wrap; margin-bottom: 10px;">
                <div class="water-glass" id="glass-1" onclick="addWater(250)"></div><div class="water-glass" id="glass-2" onclick="addWater(250)"></div><div class="water-glass" id="glass-3" onclick="addWater(250)"></div><div class="water-glass" id="glass-4" onclick="addWater(250)"></div>
                <div class="water-glass" id="glass-5" onclick="addWater(250)"></div><div class="water-glass" id="glass-6" onclick="addWater(250)"></div><div class="water-glass" id="glass-7" onclick="addWater(250)"></div><div class="water-glass" id="glass-8" onclick="addWater(250)"></div>
            </div>
            <p style="font-size: 12px; color: var(--hint-color); margin-top: 0; margin-bottom: 0;" data-i18n="desc_water">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –Ω–∞ —Å–∫–ª—è–Ω–∫—É, —â–æ–± –¥–æ–¥–∞—Ç–∏ +250 –º–ª</p>
        </div>

        <div class="card" style="margin-top: 15px; background: rgba(191, 90, 242, 0.05); border: 1px dashed #bf5af2;">
            <h3 style="margin-top:0; color: #bf5af2;">üßä <span data-i18n="title_ai_fridge">–®–Ü-–ö—É—Ö–∞—Ä (–ó —Ç–æ–≥–æ, —â–æ —î)</span></h3>
            <p style="font-size: 12px; color: var(--hint-color); margin-top: 0;" data-i18n="desc_ai_fridge">–ù–∞–ø–∏—à—ñ—Ç—å, —è–∫—ñ –ø—Ä–æ–¥—É–∫—Ç–∏ —É –≤–∞—Å —î (–Ω–∞–ø—Ä: 2 —è–π—Ü—è, –ø–æ–º—ñ–¥–æ—Ä, —Å–∏—Ä), —ñ –®–Ü –ø—Ä–∏–¥—É–º–∞—î —Ä–µ—Ü–µ–ø—Ç –ø—ñ–¥ –≤–∞—à –∑–∞–ª–∏—à–æ–∫ –∫–∞–ª–æ—Ä—ñ–π!</p>
            <input type="text" id="fridge-ingredients" placeholder="–©–æ —î –≤ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫—É?" data-i18n-placeholder="placeholder_fridge">
            <button onclick="if(typeof generateFridgeRecipe === 'function') generateFridgeRecipe()" id="btn-fridge" style="margin-top: 10px; background: rgba(191, 90, 242, 0.15); color: #bf5af2; box-shadow: none;" data-i18n="btn_fridge_gen">üßë‚Äçüç≥ –ü—Ä–∏–¥—É–º–∞—Ç–∏ —Ä–µ—Ü–µ–ø—Ç</button>
        </div>

        <div class="card" style="margin-top: 15px; text-align: center;">
            <div style="display: flex; flex-direction: column; gap: 10px;">
                <input type="file" id="food-image-upload" accept="image/*" style="display: none;" onchange="analyzeFoodImage(event)">
                <label for="food-image-upload" id="food-upload-label" style="margin-top: 0; display: block; width: 100%; box-sizing: border-box; padding: 14px; background: rgba(50, 215, 75, 0.15); color: var(--success); border-radius: 12px; font-weight: bold; font-size: 16px; cursor: pointer; border: 1px dashed rgba(50, 215, 75, 0.4);" data-i18n="btn_photo_food">üì∏ –§–æ—Ç–æ —Å—Ç—Ä–∞–≤–∏ (–®–Ü)</label>
                <button id="btn-start-scan" onclick="if(typeof startWebScanner === 'function') startWebScanner();" style="margin: 0; padding: 14px; background: rgba(10, 132, 255, 0.15); color: var(--client-blue); border: 1px dashed rgba(10, 132, 255, 0.4); box-shadow: none;" data-i18n="btn_scan_barcode">üîç –°–∫–∞–Ω—É–≤–∞—Ç–∏ —à—Ç—Ä–∏—Ö-–∫–æ–¥</button>
                <div id="reader" style="display: none; width: 100%; border-radius: 12px; overflow: hidden; margin-top: 10px; border: 2px solid var(--client-blue);"></div>
                <button id="btn-stop-scan" onclick="if(typeof stopWebScanner === 'function') stopWebScanner();" style="display: none; margin-top: 10px; background: rgba(255, 69, 58, 0.15); color: var(--danger); box-shadow: none;" data-i18n="btn_close_scanner">‚ùå –ó–∞–∫—Ä–∏—Ç–∏ —Å–∫–∞–Ω–µ—Ä</button>
                <button id="btn-manual-barcode" onclick="if(typeof manualBarcodePrompt === 'function') manualBarcodePrompt();" style="display: none; margin-top: 10px; background: transparent; color: var(--hint-color); border: 1px solid rgba(255,255,255,0.1); box-shadow: none;" data-i18n="btn_manual_barcode">‚å®Ô∏è –í–≤–µ—Å—Ç–∏ —Ü–∏—Ñ—Ä–∏ –≤—Ä—É—á–Ω—É</button>
            </div>
        </div>

        <h3 style="margin-top: 30px;" data-i18n="title_add_food_manual">–î–æ–¥–∞—Ç–∏ –ø—Ä–∏–π–æ–º —ó–∂—ñ –≤—Ä—É—á–Ω—É</h3>
        <div class="card" style="display: flex; flex-wrap: wrap; gap: 10px;">
            <div style="width: 100%;"><label style="margin-top:0;" data-i18n="label_dish_name">–ù–∞–∑–≤–∞ —Å—Ç—Ä–∞–≤–∏</label><input type="text" id="food-name" placeholder="–ù–∞–ø—Ä: –í—ñ–≤—Å—è–Ω–∫–∞ –∑ –±–∞–Ω–∞–Ω–æ–º"></div>
            <div style="width: calc(33.3% - 7px);"><label style="margin-top:0;" data-i18n="label_weight_g">–í–∞–≥–∞ (–≥)</label><input type="number" id="food-weight"></div>
            <div style="width: calc(33.3% - 7px);"><label style="margin-top:0;" data-i18n="label_cals">–ö–∞–ª–æ—Ä—ñ—ó</label><input type="number" id="food-cal"></div>
            <div style="width: calc(33.3% - 7px);"><label style="margin-top:0;" data-i18n="label_p">–ë—ñ–ª–∫–∏</label><input type="number" id="food-prot"></div>
            <div style="width: calc(50% - 5px);"><label style="margin-top:0;" data-i18n="label_f">–ñ–∏—Ä–∏</label><input type="number" id="food-fat"></div>
            <div style="width: calc(50% - 5px);"><label style="margin-top:0;" data-i18n="label_c">–í—É–≥–ª–µ–≤–æ–¥–∏</label><input type="number" id="food-carb"></div>
            <button onclick="addManualFood()" style="margin-top: 10px; width: 100%;" data-i18n="btn_add_food">‚ûï –ó–∞–ø–∏—Å–∞—Ç–∏ —ó–∂—É</button>
        </div>

        <h3 style="margin-top: 30px;" data-i18n="title_history_today">–Ü—Å—Ç–æ—Ä—ñ—è –∑–∞ —Å—å–æ–≥–æ–¥–Ω—ñ</h3>
        <div id="food-logs-container" style="padding-bottom: 80px;"></div>
    </div>

    <div id="progress-view" class="view" style="padding-bottom: 80px;">
        <h2 class="muscle-map-header" data-i18n="title_analytics">–ê–Ω–∞–ª—ñ—Ç–∏–∫–∞ –¢—ñ–ª–∞</h2>

        <div class="card">
            <h3 style="margin-top:0; color: var(--client-blue);" data-i18n="title_muscle_recovery">–í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –º'—è–∑—ñ–≤</h3>

            <div class="muscle-map-container" style="display: flex; gap: 10px; justify-content: center; overflow: hidden; background: transparent;">
                <div style="position: relative; width: 48%; max-width: 180px;">
                    <svg id="svg-body-front" viewBox="0 0 750 1500" style="width: 100%; height: auto;"></svg>
                    <span style="position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); font-size: 10px; color: var(--hint-color); font-weight: bold;" data-i18n="map_front">–ü–ï–†–ï–î</span>
                </div>
                <div style="position: relative; width: 48%; max-width: 180px;">
                    <svg id="svg-body-back" viewBox="700 0 750 1500" style="width: 100%; height: auto;"></svg>
                    <span style="position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); font-size: 10px; color: var(--hint-color); font-weight: bold;" data-i18n="map_back">–ó–ê–î</span>
                </div>
            </div>

            <div style="display: flex; justify-content: space-around; margin-top: 20px; font-size: 11px;">
                <span data-i18n="map_legend_fresh">üü¢ –°–≤—ñ–∂—ñ</span>
                <span data-i18n="map_legend_process">üü° –í –ø—Ä–æ—Ü–µ—Å—ñ</span>
                <span data-i18n="map_legend_tired">üî¥ –í—Ç–æ–º–ª–µ–Ω—ñ</span>
            </div>
        </div>

        <div class="card">
            <h3 style="margin-top:0; color: var(--btn-color);" data-i18n="title_weight_chart">–î–∏–Ω–∞–º—ñ–∫–∞ –≤–ª–∞—Å–Ω–æ—ó –≤–∞–≥–∏</h3>
            <div class="chart-container"><canvas id="weightChart"></canvas></div>
        </div>

        <div class="card" style="margin-top: 15px;">
            <h3 style="margin-top: 0; color: #32d74b;" data-i18n="card_measurements">üìè –ó–∞–º—ñ—Ä–∏ —Ç—ñ–ª–∞ (—Å–º)</h3>
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <div style="width: calc(50% - 5px);"><label style="margin-top:0;" data-i18n="label_waist">–¢–∞–ª—ñ—è</label><input type="number" id="metric-waist" step="0.1"></div>
                <div style="width: calc(50% - 5px);"><label style="margin-top:0;" data-i18n="label_hips">–°—Ç–µ–≥–Ω–∞</label><input type="number" id="metric-hips" step="0.1"></div>
                <div style="width: calc(50% - 5px);"><label style="margin-top:0;" data-i18n="label_chest">–ì—Ä—É–¥–∏</label><input type="number" id="metric-chest" step="0.1"></div>
                <div style="width: calc(50% - 5px);"><label style="margin-top:0;" data-i18n="label_biceps">–ë—ñ—Ü–µ–ø—Å</label><input type="number" id="metric-biceps" step="0.1"></div>
            </div>
            <button id="btn-save-metrics" onclick="submitBodyMetrics()" style="margin-top: 15px; width: 100%; background: rgba(50, 215, 75, 0.15); color: var(--success); box-shadow: none;" data-i18n="btn_save_metrics">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –∑–∞–º—ñ—Ä–∏</button>
        </div>

        <div class="card" style="margin-top: 15px;">
            <h3 style="margin-top:0; color: #32d74b;" data-i18n="title_metrics_chart">–ü—Ä–æ–≥—Ä–µ—Å –æ–±'—î–º—ñ–≤</h3>
            <div class="chart-container"><canvas id="metricsChart"></canvas></div>
        </div>

        <div class="card" style="margin-top: 15px;">
            <h3 style="margin-top:0; color: var(--accent-gold);" data-i18n="title_work_weight_chart">–ü—Ä–æ–≥—Ä–µ—Å —Ä–æ–±–æ—á–∏—Ö –≤–∞–≥</h3>
            <select id="exercise-select" onchange="renderExerciseChart()" style="margin-top: 10px;"></select>
            <div class="chart-container"><canvas id="exerciseChart"></canvas></div>
        </div>
    </div>

    <div id="coach-view" class="view" style="padding-bottom: 80px;">
        <h2 style="margin-top:20px;" data-i18n="title_coach">–í–∞—à –ù–∞—Å—Ç–∞–≤–Ω–∏–∫</h2>
        <div class="card" style="text-align: center; padding: 30px 15px;">
            <div style="font-size: 50px; margin-bottom: 15px;">üßë‚Äçüè´</div>
            <h3 style="margin-top: 0;" data-i18n="title_personal_coach">–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏–π —Å—É–ø—Ä–æ–≤—ñ–¥</h3>
            <p id="coach-status-text" style="color: var(--hint-color); font-size: 14px; margin-bottom: 25px;" data-i18n="loading_ai">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö...</p>
            <button onclick="if(window.Telegram && window.Telegram.WebApp) { window.Telegram.WebApp.close(); }" style="background: rgba(50, 215, 75, 0.15); color: var(--success); box-shadow: none; margin-bottom: 10px;" data-i18n="btn_ask_question">üí¨ –ó–∞–¥–∞—Ç–∏ –ø–∏—Ç–∞–Ω–Ω—è –≤ —á–∞—Ç—ñ</button>
            <button onclick="if(window.Telegram && window.Telegram.WebApp) { window.Telegram.WebApp.close(); }" style="background: rgba(255, 214, 10, 0.15); color: var(--accent-gold); box-shadow: none;" data-i18n="btn_send_video">üìπ –ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –≤—ñ–¥–µ–æ –Ω–∞ —Ä–æ–∑–±—ñ—Ä</button>
        </div>
    </div>

    <div id="gamification-view" class="view" style="padding-bottom: 80px;">
        <div class="rpg-header" style="margin-top: 20px;">
            <div class="level-text"><span data-i18n="level_word">–†–Ü–í–ï–ù–¨</span> <span id="game-lvl">1</span></div>
            <div style="font-size: 13px; opacity: 0.8; margin-top: 8px;"><span id="game-exp">0</span> / <span id="game-exp-need">100</span> <span data-i18n="exp_to_next">EXP –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ —Ä—ñ–≤–Ω—è</span></div>
            <div class="exp-bar-bg"><div id="game-exp-fill" class="exp-bar-fill"></div></div>
        </div>
        <div class="card" style="font-size:12px; color:var(--hint-color);">
            <b style="color:var(--text-color);" data-i18n="how_to_earn_exp">–Ø–∫ –∑–∞—Ä–æ–±–ª—è—Ç–∏ –¥–æ—Å–≤—ñ–¥ (EXP)?</b><br>
            üèãÔ∏è <span data-i18n="exp_rule_1">–í–∏–∫–æ–Ω–∞–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥: +10 EXP</span><br>
            üçè <span data-i18n="exp_rule_2">–ó–∞–ø–∏—Å —ó–∂—ñ: +5 EXP</span><br>
            üìä <span data-i18n="exp_rule_3">–ß–µ–∫-—ñ–Ω: +5 EXP</span>
        </div>
        <h3 style="margin-top:20px;" data-i18n="title_achievements">–í–∞—à—ñ –î–æ—Å—è–≥–Ω–µ–Ω–Ω—è</h3>
        <div id="achievements-container" class="achieve-grid"></div>
    </div>

    <div id="recipe-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 id="recipe-title" style="margin-top:0; color: #bf5af2; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px;">–†–µ—Ü–µ–ø—Ç</h3>
            <div style="display: flex; gap: 10px; margin-bottom: 15px; font-size: 13px; font-weight: bold; background: rgba(255,255,255,0.05); padding: 10px; border-radius: 10px;">
                <div>üî• <span id="recipe-cal"></span> <span data-i18n="kcal">–∫–∫–∞–ª</span></div>
                <div><span data-i18n="macro_p">–ë:</span> <span id="recipe-p"></span></div>
                <div><span data-i18n="macro_f">–ñ:</span> <span id="recipe-f"></span></div>
                <div><span data-i18n="macro_c">–í:</span> <span id="recipe-c"></span></div>
            </div>
            <div id="recipe-text" style="font-size: 14px; white-space: pre-wrap; line-height: 1.5; margin-bottom: 20px;"></div>
            <button id="btn-eat-recipe" onclick="if(typeof eatRecipe === 'function') eatRecipe()" style="margin-bottom: 10px; background: #32d74b; color: #000;" data-i18n="btn_eat_recipe">‚ûï –ó–∞–ø–∏—Å–∞—Ç–∏ –≤ —â–æ–¥–µ–Ω–Ω–∏–∫</button>
            <button class="action-btn delete" style="width: 100%; border-radius: 12px; font-size: 16px; font-weight: bold;" onclick="closeModal('recipe-modal')" data-i18n="btn_close">–ó–∞–∫—Ä–∏—Ç–∏</button>
        </div>
    </div>

    <div id="edit-profile-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 style="margin-top:0; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 15px;" data-i18n="title_edit_profile">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ</h3>
            <div style="display: flex; gap: 15px;">
                <div style="flex: 1;"><label data-i18n="label_height">–ó—Ä—ñ—Å—Ç (—Å–º)</label><input type="number" id="edit-height"></div>
                <div style="flex: 1;"><label data-i18n="label_age">–í—ñ–∫</label><input type="number" id="edit-age"></div>
            </div>
            <div style="display: flex; gap: 15px;">
                <div style="flex: 1;"><label data-i18n="label_weight">–í–∞–≥–∞</label><input type="number" id="edit-weight" step="0.1"></div>
                <div style="flex: 1;"><label data-i18n="label_target_weight">–¶—ñ–ª—å–æ–≤–∞</label><input type="number" id="edit-target-weight" step="0.1"></div>
            </div>
            <label data-i18n="label_activity">–†—ñ–≤–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ</label>
            <select id="edit-activity">
                <option value="sedentary" data-i18n="act_sedentary">–°–∏–¥—è—á–∏–π</option>
                <option value="light" data-i18n="act_light">–õ–µ–≥–∫–∏–π</option>
                <option value="medium" data-i18n="act_medium">–°–µ—Ä–µ–¥–Ω—ñ–π</option>
                <option value="active" data-i18n="act_active">–í–∏—Å–æ–∫–∏–π</option>
                <option value="very_active" data-i18n="act_very_active">–î—É–∂–µ –≤–∏—Å–æ–∫–∏–π</option>
            </select>
            <div id="edit-cycle-container" style="display: none; background: rgba(255, 45, 85, 0.05); padding: 15px; border-radius: 12px; border: 1px dashed rgba(255, 45, 85, 0.3); margin-top: 15px;">
                <label style="color: #ff2d55; margin-top: 0;" data-i18n="cycle_start_label">–ü–µ—Ä—à–∏–π –¥–µ–Ω—å —Ü–∏–∫–ª—É</label>
                <input type="date" id="edit_cycle_start_date">
                <label style="color: #ff2d55;" data-i18n="cycle_length_label">–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å (–¥–Ω—ñ–≤)</label>
                <input type="number" id="edit_cycle_length">
            </div>
            <button onclick="submitEditProfile()" style="margin-top: 20px;" data-i18n="btn_save">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏</button>
            <button class="action-btn delete" style="width: 100%; border-radius: 12px; margin-top: 10px; font-size: 16px; font-weight: bold;" onclick="closeModal('edit-profile-modal')" data-i18n="btn_cancel">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
        </div>
    </div>

    <div id="workout-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 id="modal-title" style="margin-top:0; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 15px;">–ù–∞–∑–≤–∞ –≤–ø—Ä–∞–≤–∏</h3>
            <div id="log-form" class="log-container active">
                <div style="background: rgba(255,255,255,0.05); padding: 12px; border-radius: 10px; margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <span style="font-size: 13px; color: var(--hint-color); text-transform: uppercase;" data-i18n="target_reps">–¶—ñ–ª—å–æ–≤–∏–π –æ—Ä—ñ—î–Ω—Ç–∏—Ä:</span>
                            <div id="modal-target" style="font-weight: bold; font-size: 16px; margin-top: 4px; color: var(--accent-gold);">...</div>
                        </div>
                        <div id="modal-progress" style="font-size: 13px; color: var(--success); font-weight: bold; display: none;">–ü—ñ–¥—Ö—ñ–¥: 0/0</div>
                    </div>
                </div>
                <div id="input-strength" class="dynamic-input">
                    <div style="display: flex; gap: 15px;">
                        <div style="flex: 1;"><label data-i18n="label_weight_kg">–í–∞–≥–∞ (–∫–≥)</label><input type="number" id="set-weight" inputmode="decimal"></div>
                        <div style="flex: 1;"><label data-i18n="label_reps">–ü–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è</label><input type="number" id="set-reps" inputmode="numeric"></div>
                    </div>
                </div>
                <div id="input-cardio" class="dynamic-input" style="display: none;">
                    <div style="display: flex; gap: 15px;">
                        <div style="flex: 1;"><label data-i18n="label_duration">–ß–∞—Å (—Ö–≤)</label><input type="number" id="set-duration" inputmode="decimal"></div>
                        <div style="flex: 1;"><label data-i18n="label_distance">–í—ñ–¥—Å—Ç–∞–Ω—å (–∫–º)</label><input type="number" id="set-distance" inputmode="decimal"></div>
                    </div>
                </div>
                <div id="input-warmup" class="dynamic-input" style="display: none;">
                    <p style="text-align: center; color: var(--hint-color); font-size: 14px; margin-bottom: 10px;" data-i18n="desc_warmup">–¶—è –≤–ø—Ä–∞–≤–∞ –Ω–µ –ø–æ—Ç—Ä–µ–±—É—î –∑–∞–ø–∏—Å—É –≤–∞–≥–∏.</p>
                </div>
                <button onclick="saveSet()" style="margin-top: 25px;" id="btn-save-set" data-i18n="btn_save_set">‚úÖ –ó–∞–ø–∏—Å–∞—Ç–∏ —ñ –í—ñ–¥–ø–æ—á–∏—Ç–∏</button>
                <button class="close-btn action-btn delete" style="width: 100%; border-radius: 12px; margin-top: 10px; font-size: 16px; font-weight: bold;" onclick="closeModal('workout-modal')" data-i18n="btn_cancel">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
            </div>
            <div id="timer-view" class="timer-container">
                <p style="opacity: 0.8; margin-bottom: 0; text-align: center; font-size: 18px;" data-i18n="timer_title">–ß–∞—Å –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è</p>
                <div class="timer-display" id="timer-text">01:30</div>
                <div class="timer-controls">
                    <button class="timer-btn" onclick="adjustTimer(-15)">-15 —Å–µ–∫</button>
                    <button class="timer-btn" onclick="adjustTimer(30)">+30 —Å–µ–∫</button>
                </div>
                <button class="secondary" onclick="skipTimer()" data-i18n="btn_skip_timer">‚è© –ü—Ä–æ–ø—É—Å—Ç–∏—Ç–∏</button>
            </div>
        </div>
    </div>

    <div id="edit-food-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 style="margin-top:0;" data-i18n="title_edit_food">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –ø—Ä–∏–π–æ–º —ó–∂—ñ</h3>
            <input type="hidden" id="edit-food-id">
            <label data-i18n="label_dish_name">–ù–∞–∑–≤–∞ —Å—Ç—Ä–∞–≤–∏</label>
            <input type="text" id="edit-food-name">
            <div style="display: flex; gap: 10px;">
                <div style="flex: 1;"><label data-i18n="label_weight_g">–í–∞–≥–∞ (–≥)</label><input type="number" id="edit-food-weight"></div>
                <div style="flex: 1;"><label data-i18n="label_cals">–ö–∞–ª–æ—Ä—ñ—ó</label><input type="number" id="edit-food-cal"></div>
            </div>
            <div style="display: flex; gap: 10px;">
                <div style="flex: 1;"><label data-i18n="label_p">–ë—ñ–ª–∫–∏</label><input type="number" id="edit-food-prot"></div>
                <div style="flex: 1;"><label data-i18n="label_f">–ñ–∏—Ä–∏</label><input type="number" id="edit-food-fat"></div>
                <div style="flex: 1;"><label data-i18n="label_c">–í—É–≥–ª.</label><input type="number" id="edit-food-carb"></div>
            </div>
            <div style="margin-top: 15px; padding: 15px; background: rgba(10, 132, 255, 0.05); border: 1px dashed var(--client-blue); border-radius: 12px;">
                <h4 style="margin-top: 0; color: var(--client-blue);">‚ú® –®–Ü-–ü–µ—Ä–µ—Ä–∞—Ö—É–Ω–æ–∫</h4>
                <p style="font-size: 12px; color: var(--hint-color); margin-top: 0;">–®–Ü –ø–æ–º–∏–ª–∏–≤—Å—è? –í–≤–µ–¥—ñ—Ç—å, —â–æ –∑–º—ñ–Ω–∏—Ç–∏.</p>
                <input type="text" id="edit-food-correction" placeholder="–ù–∞–ø—Ä: '–¶–µ –±—É–ª–æ 200–≥ —Å–≤–∏–Ω–∏–Ω–∏'">
                <button id="btn-recalc-food" onclick="if(typeof recalculateFoodAI === 'function') recalculateFoodAI()" style="margin-top: 10px; background: rgba(10, 132, 255, 0.15); color: var(--client-blue); box-shadow: none;">‚ú® –ü–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏</button>
            </div>
            <button onclick="if(typeof submitEditFood === 'function') submitEditFood()" style="margin-top: 20px;" data-i18n="btn_save">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏</button>
            <button class="action-btn delete" style="width: 100%; border-radius: 12px; margin-top: 10px; font-size: 16px; font-weight: bold;" onclick="closeModal('edit-food-modal')" data-i18n="btn_cancel">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
        </div>
    </div>

    <div id="edit-exercise-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 id="edit-ex-title" style="margin-top:0;">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –≤–ø—Ä–∞–≤—É</h3>
            <input type="hidden" id="edit-ex-day">
            <input type="hidden" id="edit-ex-index">
            <label data-i18n="label_ex_name">–ù–∞–∑–≤–∞ –≤–ø—Ä–∞–≤–∏</label>
            <input type="text" id="edit-ex-name">
            <div style="display: flex; gap: 10px;">
                <div style="flex: 1;"><label data-i18n="label_sets">–ü—ñ–¥—Ö–æ–¥–∏</label><input type="text" id="edit-ex-sets"></div>
                <div style="flex: 1;"><label data-i18n="label_reps_time">–ü–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è</label><input type="text" id="edit-ex-reps"></div>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button onclick="if(typeof submitEditExercise === 'function') submitEditExercise()" style="margin-top: 0; flex: 3;" data-i18n="btn_save">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏</button>
                <button id="btn-delete-ex" class="action-btn delete" onclick="if(typeof deleteExercise === 'function') deleteExercise()" style="flex: 1; height: auto;">üóëÔ∏è</button>
            </div>
            <button class="action-btn delete" style="width: 100%; border-radius: 12px; margin-top: 10px; font-size: 16px; font-weight: bold;" onclick="closeModal('edit-exercise-modal')" data-i18n="btn_cancel">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
        </div>
    </div>

    <div id="exercise-info-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 id="info-modal-title" style="margin-top:0; color: var(--btn-color);">–ù–∞–∑–≤–∞ –≤–ø—Ä–∞–≤–∏</h3>
            <div style="margin-bottom: 15px;">
                <span style="font-size: 12px; color: var(--hint-color); font-weight: bold;" data-i18n="target_muscles">üéØ –¶—ñ–ª—å–æ–≤—ñ –º'—è–∑–∏:</span>
                <div id="info-modal-muscles" style="font-size: 14px; color: var(--text-color); margin-top: 4px; font-weight: bold;">...</div>
            </div>
            <div style="margin-bottom: 20px; background: rgba(255,255,255,0.05); padding: 12px; border-radius: 12px;">
                <span style="font-size: 12px; color: var(--hint-color); font-weight: bold;" data-i18n="instruction">üìñ –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è:</span>
                <div id="info-modal-instruction" style="font-size: 14px; color: var(--text-color); margin-top: 8px; line-height: 1.5; white-space: pre-wrap;">...</div>
            </div>
            <a id="btn-youtube-link" href="#" target="_blank" style="display: none; background: #FF0000; color: #FFF; text-align: center; padding: 14px; border-radius: 12px; text-decoration: none; font-weight: bold; font-size: 16px; margin-bottom: 10px;">üé• YouTube</a>
            <button class="action-btn delete" style="width: 100%; border-radius: 12px; font-size: 16px; font-weight: bold;" onclick="closeModal('exercise-info-modal')" data-i18n="btn_close">–ó–∞–∫—Ä–∏—Ç–∏</button>
        </div>
    </div>

    <div id="quick-comp-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 style="margin-top:0;" data-i18n="title_comp_settings">–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–º–∞–≥–∞–Ω—å</h3>
            <label data-i18n="comp_sport_label">–í–∏–¥ —Å–ø–æ—Ä—Ç—É</label>
            <input type="text" id="quick-comp-sport" placeholder="–ù–∞–ø—Ä: –ü–∞—É–µ—Ä–ª—ñ—Ñ—Ç–∏–Ω–≥">
            <label data-i18n="comp_date_label">–î–∞—Ç–∞ –∑–º–∞–≥–∞–Ω—å</label>
            <input type="date" id="quick-comp-date">
            <button id="btn-save-quick-comp" onclick="saveQuickComp()" style="margin-top: 20px;" data-i18n="btn_save">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏</button>
            <button onclick="clearCompetition()" class="secondary" style="margin-top: 10px;" data-i18n="btn_cancel_comp">‚ùå –°–∫–∞—Å—É–≤–∞—Ç–∏ –ø—ñ–¥–≥–æ—Ç–æ–≤–∫—É</button>
            <button class="action-btn delete" style="width: 100%; border-radius: 12px; margin-top: 10px; font-size: 16px; font-weight: bold;" onclick="closeModal('quick-comp-modal')" data-i18n="btn_close">–ó–∞–∫—Ä–∏—Ç–∏</button>
        </div>
    </div>
    <nav class="bottom-nav" id="bottom-nav" style="display:none;">
        <div class="nav-item" onclick="navTo('profile-view', this)"><span>üë§</span><span class="nav-label" data-i18n="nav_profile">–ü—Ä–æ—Ñ—ñ–ª—å</span></div>
        <div class="nav-item active" onclick="navTo('dashboard-view', this)"><span>üèãÔ∏è</span><span class="nav-label" data-i18n="nav_plan">–ü–ª–∞–Ω</span></div>
        <div class="nav-item" id="nav-cycle-btn" style="display: none;" onclick="navTo('cycle-view', this)"><span>üå∏</span><span class="nav-label" data-i18n="nav_cycle">–¶–∏–∫–ª</span></div>
        <div class="nav-item" onclick="navTo('nutrition-view', this)"><span>üçè</span><span class="nav-label" data-i18n="nav_food">–á–∂–∞</span></div>
        <div class="nav-item" onclick="navTo('progress-view', this)"><span>üìà</span><span class="nav-label" data-i18n="nav_data">–î–∞–Ω—ñ</span></div>
        <div class="nav-item" onclick="navTo('coach-view', this)"><span>üßë‚Äçüè´</span><span class="nav-label" data-i18n="nav_chat">–ß–∞—Ç</span></div>
        <div class="nav-item" onclick="navTo('gamification-view', this)"><span>üèÜ</span><span class="nav-label" data-i18n="nav_ranks">–†–∞–Ω–≥–∏</span></div>
    </nav>

    <script>
        let lastRecipeData = null;
        async function generateFridgeRecipe() {
            const ingredients = document.getElementById('fridge-ingredients').value.trim();
            if (!ingredients) return;
            const btn = document.getElementById('btn-fridge');
            btn.disabled = true; btn.innerText = "‚è≥...";
            try {
                const res = await fetch('/api/generate_recipe', {
                    method: 'POST', headers: {'Content-Type': 'application/json', 'ngrok-skip-browser-warning': 'true'},
                    body: JSON.stringify({ user_id: userId, ingredients: ingredients })
                });
                const data = await res.json();
                if (data.status === 'success' && data.data) {
                    lastRecipeData = data.data;
                    document.getElementById('recipe-title').innerText = data.data.dish_name;
                    document.getElementById('recipe-cal').innerText = data.data.calories;
                    document.getElementById('recipe-p').innerText = data.data.protein;
                    document.getElementById('recipe-f').innerText = data.data.fats;
                    document.getElementById('recipe-c').innerText = data.data.carbs;
                    document.getElementById('recipe-text').innerText = data.data.recipe_text;
                    document.getElementById('recipe-modal').classList.add('active');
                }
            } catch (e) { } finally {
                btn.disabled = false; btn.innerText = loc('btn_fridge_gen', "üßë‚Äçüç≥ –ü—Ä–∏–¥—É–º–∞—Ç–∏ —Ä–µ—Ü–µ–ø—Ç");
                document.getElementById('fridge-ingredients').value = '';
            }
        }

        async function eatRecipe() {
            if(!lastRecipeData) return;
            await fetch('/api/log_nutrition', {
                method: 'POST', headers: {'Content-Type': 'application/json', 'ngrok-skip-browser-warning': 'true'},
                body: JSON.stringify({ user_id: userId, dish_name: lastRecipeData.dish_name + ' üßë‚Äçüç≥', calories: lastRecipeData.calories, protein: lastRecipeData.protein, fats: lastRecipeData.fats, carbs: lastRecipeData.carbs, weight_g: 0 })
            });
            closeModal('recipe-modal');
            if(typeof loadNutrition === 'function') loadNutrition();
            if(typeof loadGamification === 'function') loadGamification();
            if (tg && tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
        }
    </script>

    <script src="/static/js/anatomy/bodyFront.js?v=1" defer></script>
    <script src="/static/js/anatomy/bodyBack.js?v=1" defer></script>
    <script src="/static/js/anatomy/bodyFemaleFront.js?v=1" defer></script>
    <script src="/static/js/anatomy/bodyFemaleBack.js?v=1" defer></script>
    <script src="/static/js/anatomy/anatomy_mapper.js?v=1" defer></script>

    <script src="/static/js/client.js?v=44" defer></script>
    <script src="/static/js/client_tracking.js?v=44" defer></script>

</body>
</html>